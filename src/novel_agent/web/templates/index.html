{% extends "base.html" %}

{% block title %}ä»ªè¡¨ç›˜ - ç•ªèŒ„å°è¯´Agent{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ğŸ“š æˆ‘çš„é¡¹ç›®</h1>
    <div class="page-actions">
        <button class="btn btn-primary" onclick="showCreateProjectModal()">
            âœ¨ åˆ›å»ºæ–°é¡¹ç›®
        </button>
    </div>
</div>

<!-- ç»Ÿè®¡å¡ç‰‡ -->
<div class="stats-grid" id="statsGrid">
    <div class="stat-card">
        <div class="stat-value" id="statProjects">-</div>
        <div class="stat-label">é¡¹ç›®æ•°</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="statChapters">-</div>
        <div class="stat-label">æ€»ç« èŠ‚</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="statTokens">-</div>
        <div class="stat-label">Tokenä½¿ç”¨</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="statCost">-</div>
        <div class="stat-label">é¢„ä¼°æˆæœ¬</div>
    </div>
</div>

<!-- é¡¹ç›®åˆ—è¡¨ -->
<div class="card-grid" id="projectsGrid">
    <div class="loading">
        <div class="spinner"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.initPage = async function () {
        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        loadProjects();

        // åŠ è½½ç»Ÿè®¡
        try {
            const { projects } = await API.getProjects();
            const usage = await API.getUsage();

            document.getElementById('statProjects').textContent = projects.length;
            document.getElementById('statChapters').textContent =
                projects.reduce((sum, p) => sum + (p.chapter_count || 0), 0);
            document.getElementById('statTokens').textContent =
                (usage.total_tokens || 0).toLocaleString();
            document.getElementById('statCost').textContent =
                '$' + (usage.total_cost_usd || 0).toFixed(2);
        } catch (e) {
            console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥', e);
        }
    };
</script>
{% endblock %}