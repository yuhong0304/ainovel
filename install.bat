@echo off
chcp 65001 >nul
title ç•ªèŒ„å°è¯´Agent - ä¸€é”®å®‰è£…

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘         ðŸ“š ç•ªèŒ„å°è¯´Agent - ä¸€é”®å®‰è£…ç¨‹åº                      â•‘
echo â•‘         Novel Agent - One-Click Installer                    â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: æ£€æŸ¥ Python
echo [1/5] æ£€æŸ¥ Python çŽ¯å¢ƒ...
python --version >nul 2>&1
if errorlevel 1 (
    echo âŒ æœªæ£€æµ‹åˆ° Pythonï¼è¯·å…ˆå®‰è£… Python 3.9+
    echo    ä¸‹è½½åœ°å€: https://www.python.org/downloads/
    echo.
    pause
    exit /b 1
)

for /f "tokens=2" %%i in ('python --version 2^>^&1') do set PYTHON_VERSION=%%i
echo âœ… æ£€æµ‹åˆ° Python %PYTHON_VERSION%

:: åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
echo.
echo [2/5] åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ...
if not exist ".venv" (
    python -m venv .venv
    echo âœ… è™šæ‹ŸçŽ¯å¢ƒåˆ›å»ºæˆåŠŸ
) else (
    echo âœ… è™šæ‹ŸçŽ¯å¢ƒå·²å­˜åœ¨
)

:: æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
echo.
echo [3/5] æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ...
call .venv\Scripts\activate.bat

:: å‡çº§ pip
echo.
echo [4/5] å‡çº§ pip...
python -m pip install --upgrade pip -q

:: å®‰è£…ä¾èµ–
echo.
echo [5/5] å®‰è£…é¡¹ç›®ä¾èµ–...
pip install -e . -q
if errorlevel 1 (
    echo âŒ å®‰è£…ä¾èµ–å¤±è´¥ï¼
    pause
    exit /b 1
)

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                     âœ… å®‰è£…å®Œæˆ!                             â•‘
echo â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
echo â•‘                                                              â•‘
echo â•‘  ä¸‹ä¸€æ­¥:                                                     â•‘
echo â•‘  1. å¤åˆ¶ .env.example ä¸º .env                                â•‘
echo â•‘  2. åœ¨ .env ä¸­å¡«å…¥ä½ çš„ GEMINI_API_KEY                        â•‘
echo â•‘  3. åŒå‡» start.bat å¯åŠ¨ç¨‹åº                                  â•‘
echo â•‘                                                              â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: æ£€æŸ¥ .env æ–‡ä»¶
if not exist ".env" (
    echo âš ï¸  æ£€æµ‹åˆ° .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­£åœ¨ä»Žæ¨¡æ¿åˆ›å»º...
    copy .env.example .env >nul
    echo âœ… å·²åˆ›å»º .env æ–‡ä»¶ï¼Œè¯·ç¼–è¾‘å¡«å…¥ä½ çš„ API Key
    echo.
    echo    æŒ‰ä»»æ„é”®æ‰“å¼€ .env æ–‡ä»¶è¿›è¡Œç¼–è¾‘...
    pause >nul
    notepad .env
)

echo æŒ‰ä»»æ„é”®é€€å‡º...
pause >nul
