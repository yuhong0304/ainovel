@echo off
chcp 65001 >nul
setlocal EnableDelayedExpansion
title ç•ªèŒ„å°è¯´Agent - ä¸€é”®å®‰è£…

cls
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘         ğŸ“š ç•ªèŒ„å°è¯´Agent - ä¸€é”®å®‰è£…ç¨‹åº v1.1                 â•‘
echo â•‘         Novel Agent - One-Click Installer                    â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: ============ æ­¥éª¤ 1: æ£€æŸ¥ Python ============
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo  [1/5] æ£€æŸ¥ Python ç¯å¢ƒ
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

python --version >nul 2>&1
if errorlevel 1 (
    echo    âŒ æœªæ£€æµ‹åˆ° Pythonï¼è¯·å…ˆå®‰è£… Python 3.9+
    echo    ä¸‹è½½åœ°å€: https://www.python.org/downloads/
    pause
    exit /b 1
)

for /f "tokens=2" %%i in ('python --version 2^>^&1') do set PYTHON_VERSION=%%i
echo    âœ… Python %PYTHON_VERSION%

:: ============ æ­¥éª¤ 2: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ ============
echo.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo  [2/5] åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

if not exist ".venv" (
    echo    â³ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒä¸­...
    python -m venv .venv
    echo    âœ… è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå®Œæˆ
) else (
    echo    âœ… è™šæ‹Ÿç¯å¢ƒå·²å­˜åœ¨
)

:: ============ æ­¥éª¤ 3: æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ ============
echo.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo  [3/5] æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
call .venv\Scripts\activate.bat
echo    âœ… å·²æ¿€æ´»

:: ============ æ­¥éª¤ 4: å‡çº§ pip ============
echo.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo  [4/5] å‡çº§ pip
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo    â³ å‡çº§ä¸­...
python -m pip install --upgrade pip -q
echo    âœ… pip å·²æ˜¯æœ€æ–°

:: ============ æ­¥éª¤ 5: å®‰è£…ä¾èµ– ============
echo.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo  [5/5] å®‰è£…é¡¹ç›®ä¾èµ–
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo.
echo    â³ æ­£åœ¨å®‰è£…ä¾èµ–åŒ…ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ...
echo.
echo    [â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%% - google-generativeai
pip install google-generativeai -q
echo    [â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 20%% - chromadb
pip install chromadb -q
echo    [â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30%% - flask
pip install flask flask-cors -q
echo    [â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘] 40%% - jinja2
pip install jinja2 -q
echo    [â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘] 50%% - rich
pip install rich -q
echo    [â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘] 60%% - pyyaml
pip install pyyaml python-dotenv -q
echo    [â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘] 70%% - å®‰è£…é¡¹ç›®åŒ…
pip install -e . -q
if errorlevel 1 (
    echo.
    echo    âŒ å®‰è£…å¤±è´¥ï¼æ­£åœ¨æ˜¾ç¤ºè¯¦ç»†é”™è¯¯...
    echo.
    pip install -e .
    pause
    exit /b 1
)
echo    [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“] 100%% - å…¨éƒ¨å®Œæˆ!
echo.
echo    âœ… æ‰€æœ‰ä¾èµ–å®‰è£…å®Œæˆ

:: ============ å®Œæˆ ============
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                     âœ… å®‰è£…å®Œæˆ!                             â•‘
echo â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
echo â•‘                                                              â•‘
echo â•‘  ğŸ“‹ ä¸‹ä¸€æ­¥:                                                  â•‘
echo â•‘     1. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ GEMINI_API_KEY               â•‘
echo â•‘     2. åŒå‡» start.bat å¯åŠ¨ç¨‹åº                               â•‘
echo â•‘                                                              â•‘
echo â•‘  ğŸŒ è·å– API Key:                                            â•‘
echo â•‘     https://aistudio.google.com/app/apikey                   â•‘
echo â•‘                                                              â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: æ£€æŸ¥å¹¶åˆ›å»º .env æ–‡ä»¶
if not exist ".env" (
    echo âš ï¸  æ­£åœ¨åˆ›å»º .env é…ç½®æ–‡ä»¶...
    copy .env.example .env >nul 2>&1
    echo âœ… å·²åˆ›å»º .env æ–‡ä»¶
    echo.
    echo    æŒ‰ä»»æ„é”®æ‰“å¼€é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘...
    pause >nul
    notepad .env
) else (
    echo âœ… .env é…ç½®æ–‡ä»¶å·²å­˜åœ¨
)

echo.
echo ğŸ‰ ç°åœ¨å¯ä»¥åŒå‡» start.bat å¯åŠ¨ç¨‹åºäº†ï¼
echo.
pause
